plugins {
  id 'application'
}

ext {
  generatedSourcesDir = "${buildDir}/generated/src/java"
}

repositories {
  jcenter()
  mavenLocal()
}

application {
  mainClassName = 'example.Main'
}

configurations {
  rpc
}

dependencies {
  rpc 'co.present.present-rpc:rpc-compiler:0.1-SNAPSHOT'

  compile 'javax.servlet:javax.servlet-api:3.1.0'

  implementation 'co.present.present-rpc:rpc-server:0.1-SNAPSHOT'
  implementation 'org.eclipse.jetty:jetty-servlet:9.4.15.v20190215'
}

task generateProtos(type: JavaExec) {
  classpath = configurations.rpc
  main = 'present.rpc.RpcCompiler'
  args = [
          '--proto_path=src/main/proto',
          "--java_out=$generatedSourcesDir"
  ]
}

compileJava {
  dependsOn generateProtos
}

sourceSets.main.java.srcDirs += generatedSourcesDir

